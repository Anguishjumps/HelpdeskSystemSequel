<html>
<title>Test Main Page</title>
<link href="./shellstylesheet.css" rel="stylesheet">

<head>
	<style>
		/*
#9EA3B0 light grey
#546A7B blue
#0D1F2D navy
*/

		* {
			box-sizing: border-box
		}

		body {
			font-family: Verdana, Arial, Helvetica, sans-serif;
			background-color: #0D1F2D;
		}

		.center {
			text-align: center;
		}

		body,
		td,
		th {
			color: #F0F0F0;
		}

		.textinput {
			font-size: larger;
			text-align: centre;
			border: 2px solid black;
			font-weight: bold;
			margin: auto;
			cursor: text;
			width: 80%;
			height: 10%;
			border-radius: 4px;
		}

		.searchbutton {
			font-size: larger;
			text-align: centre;
			color: #2C2C3C;
			border: 2px solid black;
			font-weight: bold;
			background-color: #85C7F2;
			margin: auto;
			cursor: pointer;
			width: 10%;
			height: 10%;
			border-radius: 4px;
			transition: transform .2s;
		}

		.searchbutton:hover {
			transform: scale(1.1);
		}

		.container {
			width: 100%;
			overflow: hidden;

		}

		.maindiv {
			width: 79%;
			height: 100%;
			background: #0D1F2D;
			border: 0px solid #2C2C3C;
			overflow: hidden;
			float: left;
		}

		.maindiv ul {
			list-style: none;
			line-height: 100%;

		}

		.sidebarheader {
			margin: auto;
			width: 50%;
			padding: 10px;
		}

		.sidebarbutton {
			font-size: larger;
			text-align: centre;
			color: #F0F0F0;
			border: 1px solid black;
			font-weight: bold;
			background-color: #546A7B;
			margin: auto;
			cursor: pointer;
			width: 100%;
			height: 20%;
		}

		.sidebarbutton:hover {
			background-color: #9EA3B0;

		}

		.nav {
			width: 20%;
			height: 100%;
			background: #5D6F7D;
			border: 1px solid #2C2C3C;
			overflow: auto;
			float: left;
		}

		.nav ul {
			line-height: 100%;
			list-style-type: none;
			padding: 0;
			margin: 0;
		}

		.nav form {
			margin: auto;
			text-align: centre;
		}

		table,
		th,
		td {
			border: 1px solid black;
			border-collapse: collapse;
		}

		th,
		td {
			padding: 15px;
		}

		/* Modal */


		/* The Modal (background) */

		.modal {
			display: none;
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgb(0, 0, 0);
			background-color: rgba(0, 0, 0, 0.4);
		}

		.modal-content {
			background-color: #fefefe;
			margin: 5% auto;
			border: 1px solid #888;
			width: 50%;
			border-radius: 0.5rem;
		}

		@media (max-width: 768px) {
			.modal-content {
				width: 75%;
			}
		}

		.modal-header {
			height: 40px;
			padding: 1rem;
			border-top-right-radius: 10px;
			border-top-left-radius: 10px;
			display: flex;
		}

		.modal-title {
			font-weight: 100;
			width: 100%;
			margin: 0;
		}

		.modal-body {
			padding: 1rem;
			font-size: 0.75rem;
		}

		.modal-footer {
			padding: 1rem;
			display: flex;
		}

		.button-close {
			float: right;
			width: 3rem;
			height: 3rem;
			background-color: lightgrey;
		}

		.button-close-bottom {
			margin-left: auto;
			background-color: lightgrey;
		}

		.modal-footer>button {
			display: inline-block;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="header">
		</div>
		<div class="wrapper clearfix">
			<div class="nav">
				<ul>
					<h1 class="sidebarheader">Menu</h1>
					<!-- <li colspan=1><input type="submit" name="Search" id="Search" value="Search ðŸ”Ž" class="sidebarbutton"
							title="mouseover text" /></li> -->
					<form action="/user" method="get">
						<input type="submit" value="Home" class="sidebarbutton">
					</form>
					<form action="/user/history" method="get">
						<input type="submit" value="User History" class="sidebarbutton">
					</form>
					<form action="/user/contact" method="get">
						<input type="submit" value="Contact" class="sidebarbutton">
					</form>
					<form action="/" method="get">
						<input type="submit" value="Log Out" class="sidebarbutton">
					</form>
				</ul>
			</div>

			<!-- View ticket modal -->

			<div id="make-ticket-modal" class="modal fade" tabindex="-1">
				<div class="modal-dialog">
					<form id="update-form" name="update-form" action="user/make" method="POST" class="modal-form">
						<!-- Invisible field used for post back to same page -->
						<input type="hidden" name="form_type" value="update-ticket">
						<div class="modal-content">
							<div class="modal-header">
								<h3 class="modal-title">View ticket</h3>
								<button type="button" onclick="closeModal();" class="modal-close button-close"
									data-bs-dismiss="modal" aria-label="Close"><i class="fas fa-times"></i></button>
							</div>
							<hr>
							<div class="modal-body">
								<div class="wrapper">
									<!-- Ticket ID (automatically generated so cannot be edited) -->
									<div class="half-row">
										<label for="viewID">Ticket ID</label>
										<input id="viewID" name="ID" type="number" placeholder="" value="" required
											disabled>
									</div>
									<!-- Created timestamp of the ticket (not editable) -->
									<div class="half-row">
										<label for="viewCreatedTimestamp">Created Timestamp</label>
										<input id="viewCreatedTimestamp" name="createdTimestamp" type="text"
											placeholder="" disabled>
									</div>
									<!-- Dropdown list of reporters -->
									<div class="full-row">
										<label for="viewReporterID">Reporter</label>
										<div class="input-extended input-extended-right">
											<select onchange="getPhoneNo(this);" id="viewReporterID" name="reporterID"
												class="personnel-select ">
												<!-- Add all reporters from database as items to select -->
												<option value=1></option>
											</select>
											<!-- Selected reporter phone number (not editable) -->
											<label class="input-extension-right" for="reporterID"
												id="viewReporterNo"></label>
										</div>
									</div>
									<!-- Dropdown list of specialist -->
									<div class="full-row">
										<label for="viewAssignedSpecialistID">Assigned Specialist</label>
										<div class="input-extended input-extended-right">
											<select onchange="getPhoneNo(this); addExternalSpecialist(this)"
												id="viewAssignedSpecialistID" name="assignedSpecialistID"
												class="personnel-select ">
												<option selected value=0>Not assigned</option>
												<!-- Option to add external specialist -->
												<option value=-1>New External Specialist</option>
												<!-- Add all specialists from database as items to select -->
												<option></option>
											</select>
											<!-- Selected specialist phone number (not editable) -->
											<label class="input-extension-right" for="specialistID"
												id="viewSpecialistNo"></label>
										</div>
									</div>
									<!-- Dropdown list of priorities for the ticket -->
									<div class="half-row">
										<label for="viewTicketPriority">Priority</label>
										<select id="viewTicketPriority" name="ticketPriority">
											<option value=1>1 (Lowest)</option>
											<option value=2>2</option>
											<option value=3>3</option>
											<option value=4>4</option>
											<option value=5>5 (Highest)</option>
										</select>
									</div>

									<!-- Dropdown list of hardware -->
									<div class="hardware-input half-row">
										<label for="viewHardwareID">Hardware</label>
										<select id="viewHardwareID" name="hardwareID">
											<option value=0>Problem is not hardware related</option>
											<!-- Add all hardware from database as items to select -->
											<option value=1></option>
										</select>
									</div>
									<!-- Resolved timestamp (not editable as automatically generated) -->
									<div class="full-row">
										<label for="viewResolvedTimestamp">Resolved Timestamp</label>
										<input id="viewResolvedTimestamp" name="resolvedTimestamp" disabled type="text"
											placeholder="">
									</div>
								</div>
							</div>
							<!-- Button group to either cancel or submit ticket -->
							<hr>
							<div class="modal-footer">
								<button type="button" onclick="closeModal();" class="modal-close button-close-bottom"
									data-bs-dismiss="modal">Close</button>
								<button type="submit">Update ticket</button>
								<!-- another onclick  -->
							</div>
						</div>
					</form>
				</div>
			</div>



			<div class="maindiv">
				<ul>
					<h1>Welcome to the mainpage!</h1>
					<form action="/user/searched" method="post">
						<li colspan=1><input placeholder="Search for a problem type..." name="searchbar" type="text"
								class="textinput" id="searchbar" value="" size="30" />
							<input type="submit" value="Search" class="searchbutton">
					</form>
					<button onclick="initiateNewTicketForm()" type="submit">new ticket</button>
				</ul>
				<%	if(point == "initialEntry") {
					%>
				<table>
					<tr>
						<% for(var u = 0; u < Object.keys(data).length; u++) { %>
						<td>
							<button onclick="grabProblemCategory()" type="submit" id=<%= data[u].tagName %>
								class="sidebarbutton">
								<%= data[u].tagName %> </button>
						</td>
						<%	if((u - 1) % 3 == 0 && u != 0) { %>
					</tr>
					<tr>
						<% }} %>
				</table>
				<% } else if (point == "maintagEntry") { %>
				<h1>maintagEntry</h1>
				<table>
					<tr>
						<th>issue</th>
						<th>resolution</th>
					</tr>
					<tr>
						<% for(var u = 0; u < Object.keys(data).length; u++) { %>
						<td>
							<%= data[u].ticketDescription %>
						</td>
						<td>
							<%= data[u].resolvedDescription %>
						</td>
					</tr>
					<tr>
						<% } %>
				</table>
				<% } else if (point == "newTicketEntry") { %>
				<h1>newTicket</h1>
				<form name="test" action="/user/processNewTicket" method="post">
					User ID:
					<input type="number" id="userId" name="userId" value=""><br><br>
					Problem Description <input type="text" id="problemDescription" name="problemDescription"
						value=""><br><br>
					Main Tag: <select name="mainTag" id="mainTag">
						<option value="" selected="selected">Select main tag</option>
					</select>
					<br><br>
					Secondary Tag: <select name="secondaryTag" id="secondaryTag">
						<option value="" selected="selected">Please select main tag first</option>
					</select>
					<br><br>
					Tertiary Tag: <select name="tertiaryTag" id="tertiaryTag">
						<option value="" selected="selected">Please select secondary tag first</option>
					</select>
					<br><br>
					<input type="submit" value="Submit">
				</form>
				<% } else { %>
				<h1>searchEntry</h1>
				<% if (data.length == 0) { %>
				<h1>NO RESULTS FOUND</h1>
				<% } else { %>
				<table>
					<tr>
						<th>issue</th>
						<th>resolution</th>
					</tr>
					<tr>
						<% for(var u = 0; u < Object.keys(data).length; u++) { %>
						<td>
							<%= data[u].ticketDescription %>
						</td>
						<td>
							<%= data[u].resolvedDescription %>
						</td>
					</tr>
					<tr>
						<% } %>
				</table>
				<% }} %>
				<div class="maindiv">
					<%- include('partials/onepartial')  %>
				</div>

			</div>
		</div>
	</div>
	<script type="text/javascript">

		function standardPost(path, params, method = 'post') {

			// The rest of this code assumes you are not using a library.
			// It can be made less verbose if you use one.
			const form = document.createElement('form');
			form.method = method;
			form.action = path;

			for (const key in params) {
				if (params.hasOwnProperty(key)) {
					const hiddenField = document.createElement('input');
					hiddenField.type = 'hidden';
					hiddenField.name = key;
					hiddenField.value = params[key];

					form.appendChild(hiddenField);
				}
			}

			document.body.appendChild(form);
			form.submit();
		}
		function grabProblemCategory() {
			// let currentVal = document.getElementById("testbtn").value
			let currentVal2 = event.target.id
			standardPost('/user/maintag', { problemCategory: currentVal2 });
			console.log(currentVal2)
		}
		function initiateNewTicketForm() {
			// ACTION: you can capture anything from the form here and pass to route
			standardPost('/user/initiatenewticket', {})
		}

		var subjectObject = {
        1: {
            3: [8, "Images", "Tables", "Lists"],
            "4": ["9", "Margins", "Backgrounds", "Float"],
            "5": ["9", "Operators", "Functions", "Conditions"]
        },
        2: {
            "6": ["Variables", "Strings", "Arrays"],
            "7": ["SELECT", "UPDATE", "DELETE"]
        }
    }

		window.onload = function() {
			var subjectSel = document.getElementById("mainTag");
			var topicSel = document.getElementById("secondaryTag");
			var chapterSel = document.getElementById("tertiaryTag");
			for (var x in subjectObject) {
				subjectSel.options[subjectSel.options.length] = new Option(x, x);
			}
			subjectSel.onchange = function () {
				//empty Chapters- and Topics- dropdowns
				chapterSel.length = 1;
				topicSel.length = 1;
				//display correct values
				for (var y in subjectObject[this.value]) {
					topicSel.options[topicSel.options.length] = new Option(y, y);
				}
			}
			topicSel.onchange = function () {
				//empty Chapters dropdown
				chapterSel.length = 1;
				//display correct values
				var z = subjectObject[subjectSel.value][this.value];
				for (var i = 0; i < z.length; i++) {
					chapterSel.options[chapterSel.options.length] = new Option(z[i], z[i]);
				}
			}
		} 
		</script>

</body>
<script src="javascript/functions1.js"></script>

</html>