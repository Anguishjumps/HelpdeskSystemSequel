<html>
<title>Test Main Page</title>
<link href="./shellstylesheet.css" rel="stylesheet">

<head>
	<style>
		/*
#9EA3B0 light grey
#546A7B blue
#0D1F2D navy
*/

		* {
			box-sizing: border-box
		}

		body {
			font-family: Verdana, Arial, Helvetica, sans-serif;
			background-color: #0D1F2D;
		}

		.center {
			text-align: center;
		}

		body,
		td,
		th {
			color: #F0F0F0;
		}

		.textinput {
			font-size: larger;
			text-align: centre;
			border: 2px solid black;
			font-weight: bold;
			margin: auto;
			cursor: text;
			width: 80%;
			height: 10%;
			border-radius: 4px;
		}

		.searchbutton {
			font-size: larger;
			text-align: centre;
			color: #2C2C3C;
			border: 2px solid black;
			font-weight: bold;
			background-color: #85C7F2;
			margin: auto;
			cursor: pointer;
			width: 10%;
			height: 10%;
			border-radius: 4px;
			transition: transform .2s;
		}

		.searchbutton:hover {
			transform: scale(1.1);
		}

		.container {
			width: 100%;
			overflow: hidden;

		}

		.maindiv {
			width: 79%;
			height: 100%;
			background: #0D1F2D;
			border: 0px solid #2C2C3C;
			overflow: hidden;
			float: left;
		}

		.maindiv ul {
			list-style: none;
			line-height: 100%;

		}

		.sidebarheader {
			margin: auto;
			width: 50%;
			padding: 10px;
		}

		.sidebarbutton {
			font-size: larger;
			text-align: centre;
			color: #F0F0F0;
			border: 1px solid black;
			font-weight: bold;
			background-color: #546A7B;
			margin: auto;
			cursor: pointer;
			width: 100%;
			height: 20%;
		}

		.sidebarbutton:hover {
			background-color: #9EA3B0;

		}

		.nav {
			width: 20%;
			height: 100%;
			background: #5D6F7D;
			border: 1px solid #2C2C3C;
			overflow: auto;
			float: left;
		}

		.nav ul {
			line-height: 100%;
			list-style-type: none;
			padding: 0;
			margin: 0;
		}

		.nav form {
			margin: auto;
			text-align: centre;
		}

		table,
		th,
		td {
			border: 1px solid black;
			border-collapse: collapse;
		}

		th,
		td {
			padding: 15px;
		}

		/* Modal */


		/* The Modal (background) */

		.modal {
			display: none;
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgb(0, 0, 0);
			background-color: rgba(0, 0, 0, 0.4);
		}

		.modal-content {
			background-color: #fefefe;
			margin: 5% auto;
			border: 1px solid #888;
			width: 50%;
			border-radius: 0.5rem;
		}

		@media (max-width: 768px) {
			.modal-content {
				width: 75%;
			}
		}

		.modal-header {
			height: 40px;
			padding: 1rem;
			border-top-right-radius: 10px;
			border-top-left-radius: 10px;
			display: flex;
		}

		.modal-title {
			font-weight: 100;
			width: 100%;
			margin: 0;
		}

		.modal-body {
			padding: 1rem;
			font-size: 0.75rem;
		}

		.modal-footer {
			padding: 1rem;
			display: flex;
		}

		.button-close {
			float: right;
			width: 3rem;
			height: 3rem;
			background-color: lightgrey;
		}

		.button-close-bottom {
			margin-left: auto;
			background-color: lightgrey;
		}

		.modal-footer>button {
			display: inline-block;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="header">
		</div>
		<div class="wrapper clearfix">
			<div class="nav">
				<ul>
					<h1 class="sidebarheader">Menu</h1>
					<!-- <li colspan=1><input type="submit" name="Search" id="Search" value="Search ðŸ”Ž" class="sidebarbutton"
							title="mouseover text" /></li> -->
					<form action="/user" method="get">
						<input type="submit" value="Home" class="sidebarbutton">
					</form>
					<form action="/user/history" method="get">
						<input type="submit" value="User History" class="sidebarbutton">
					</form>
					<form action="/user/contact" method="get">
						<input type="submit" value="Contact" class="sidebarbutton">
					</form>
					<form action="/" method="get">
						<input type="submit" value="Log Out" class="sidebarbutton">
					</form>
				</ul>
			</div>
			<div class="maindiv">
				<ul>
					<h1>Welcome to the mainpage!</h1>
					<form action="/user/searched" method="post">
						<li colspan=1><input placeholder="Search for a problem type..." name="searchbar" type="text"
								class="textinput" id="searchbar" value="" size="30" />
							<input type="submit" value="Search" class="searchbutton">
					</form>
					<button onclick="initiateNewTicketForm()" type="submit">new ticket</button>
				</ul>
				<%	if(point == "initialEntry") {
					%>
				<table>
					<tr>
						<% for(var u = 0; u < Object.keys(data).length; u++) { %>
						<td>
							<button onclick="grabProblemCategory()" type="submit" id=<%= data[u].tagName %>
								class="sidebarbutton">
								<%= data[u].tagName %> </button>
						</td>
						<%	if((u - 1) % 3 == 0 && u != 0) { %>
					</tr>
					<tr>
						<% }} %>
				</table>
				<% } else if (point == "maintagEntry") { %>
				<h1>maintagEntry</h1>
				<table>
					<tr>
						<th>issue</th>
						<th>resolution</th>
					</tr>
					<tr>
						<% for(var u = 0; u < Object.keys(data).length; u++) { %>
						<td>
							<%= data[u].ticketDescription %>
						</td>
						<td>
							<%= data[u].resolvedDescription %>
						</td>
					</tr>
					<tr>
						<% } %>
				</table>
				<% } else if (point == "newTicketEntry") { %>
				<h1>newTicket</h1>
				<form name="test" action="/user/processNewTicket" method="post">
					User ID:
					<input type="number" id="userId" name="userId" value=""><br><br>
					Problem Description: <input type="text" id="problemDescription" name="problemDescription"
						value=""><br><br>
					mainTag:
					<select name="mainTag" id="mainTag"
						onchange="secondaryTagChangeFunction(<%=JSON.stringify(mainTagObject)%>)">
						<option value="select-mainTag-value" selected="selected">Select main tag</option>
						<% let values = Object.keys(mainTagObject)
       for (let index=0;index< values.length;index++) { %>
						<option value="<%=values[index]%>"><%=values[index]%></option>
						<% }%>
					</select>
					<br /><br />
					secondaryTag:
					<select name="secondaryTag" id="secondaryTag"
						onchange="tertiaryTagChangeFunction(<%=JSON.stringify(mainTagObject)%>)">
						<option value="" selected="selected">
							Please select main tag first
						</option>
					</select>
					<br /><br />
					tertiaryTag:
					<select name="tertiaryTag" id="tertiaryTag">
						<option value="" selected="selected">
							Please select secondary tag first
						</option>
					</select>
					<br /><br />
					<br><br>
					<input type="submit" value="Submit">
				</form>
				<% } else { %>
				<h1>searchEntry</h1>
				<% if (data.length == 0) { %>
				<h1>NO RESULTS FOUND</h1>
				<% } else { %>
				<table>
					<tr>
						<th>issue</th>
						<th>resolution</th>
					</tr>
					<tr>
						<% for(var u = 0; u < Object.keys(data).length; u++) { %>
						<td>
							<%= data[u].ticketDescription %>
						</td>
						<td>
							<%= data[u].resolvedDescription %>
						</td>
					</tr>
					<tr>
						<% } %>
				</table>
				<% }} %>
				<div class="maindiv">
					<%- include('partials/onepartial')  %>
				</div>

			</div>
		</div>
	</div>
	<script type="text/javascript">

		function standardPost(path, params, method = 'post') {

			// The rest of this code assumes you are not using a library.
			// It can be made less verbose if you use one.
			const form = document.createElement('form');
			form.method = method;
			form.action = path;

			for (const key in params) {
				if (params.hasOwnProperty(key)) {
					const hiddenField = document.createElement('input');
					hiddenField.type = 'hidden';
					hiddenField.name = key;
					hiddenField.value = params[key];

					form.appendChild(hiddenField);
				}
			}

			document.body.appendChild(form);
			form.submit();
		}
		function grabProblemCategory() {
			// let currentVal = document.getElementById("testbtn").value
			let currentVal2 = event.target.id
			standardPost('/user/maintag', { problemCategory: currentVal2 });
			console.log(currentVal2)
		}
		function initiateNewTicketForm() {
			// ACTION: you can capture anything from the form here and pass to route
			standardPost('/user/initiatenewticket', {})
		}

		function secondaryTagChangeFunction(mainTagObject) {
			let mainTagSel = document.getElementById("mainTag");
			let secondaryTagSel = document.getElementById("secondaryTag");
			let tertiaryTagSel = document.getElementById("tertiaryTag")
			if (mainTagSel.value !== "select-mainTag-value") {
				let possibleValuesForSecondaryTag = Object.keys(mainTagObject[mainTagSel.value])
				secondaryTagSel.options[0] = new Option("select secondary tag", "select secondary tag")
				tertiaryTagSel.length = 0
				let optionsReset = document.createElement("option")
				optionsReset.text = "Please select secondary tag first"
				optionsReset.value = "Please select secondary tag first"
				tertiaryTagSel.add(optionsReset)
				for (let index = 0; index < possibleValuesForSecondaryTag.length; index++) {
					secondaryTagSel.options[index + 1] = new Option(possibleValuesForSecondaryTag[index], possibleValuesForSecondaryTag[index])
				}
			} else {
				secondaryTagSel.length = 0
				let optionsReset = document.createElement("option")
				optionsReset.text = "Please select main tag first"
				optionsReset.value = "Please select main tag first"
				secondaryTagSel.add(optionsReset)
				tertiaryTagSel.length = 0
				optionsReset = document.createElement("option")
				optionsReset.text = "Please select secondary tag first"
				optionsReset.value = "Please select secondary tag first"
				tertiaryTagSel.add(optionsReset)
			}
		}
		function tertiaryTagChangeFunction(mainTagObject) {
			let mainTagSel = document.getElementById("mainTag");
			let secondaryTagSel = document.getElementById("secondaryTag");
			let tertiaryTagSel = document.getElementById("tertiaryTag")
			if (secondaryTagSel.value !== "select secondary tag") {
				let possibleValuesForTertiaryTagArr = mainTagObject[mainTagSel.value][secondaryTagSel.value]
				tertiaryTagSel.options[0] = new Option("select tertiary tag", "select tertiary tag")
				for (let index = 0; index < possibleValuesForTertiaryTagArr.length; index++) {
					tertiaryTagSel.options[index + 1] = new Option(possibleValuesForTertiaryTagArr[index], possibleValuesForTertiaryTagArr[index])
				}
			}
		}

	</script>



</body>
<script src="javascript/functions1.js"></script>

</html>