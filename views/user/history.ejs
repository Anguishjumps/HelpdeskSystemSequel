<!DOCTYPE HTML>
<html>
	<title>User History</title>
	<link href="/css/shellstylesheet.css" rel="stylesheet">
	<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<div class="container">
			<div class="header">
			</div>
			<div class="wrapper clearfix">
				<div class="nav">
					<ul>
						<h1 class="sidebarheader">Site Navigation</h1>
						<li colspan=1><input type="submit" onclick="location.href='./';" name="NavHome" id="NavHome" value="Home 🏠" class="sidebarbutton" title="Browse Existing Solutions" /></li>	
						<li colspan=1><input type="submit" onclick="location.href='./history';" name="NavHistory" id="NavHistory" value="User History 📋" class="sidebarbutton" title="Access Your Past Tickets" /></li>	
						<li colspan=1><input type="submit" onclick="location.href='./active-issues';" name="NavIssues" id="NavIssues" value="Active Issues 🏃" class="sidebarbutton" title="Monitor Your Active Tickets" /></li>	
						<li colspan=1><input type="submit" onclick="location.href='./contact';" name="NavContact" id="NavContact" value="Contact Specialist ✉️" class="sidebarbutton" title="Submit a Ticket to Our Specialists" /></li>	
						<li colspan=1><form action="../logout" method="POST"><input type="submit" name="NavLogout" id="NavLogout" value="Log Out 💨" class="sidebarbutton" title="Log Out of Your Account" /></form></li>
					</ul>
				</div>
				<div class="maindiv" id="maindiv">
					<ul>
						<h1>Make-It-All Virtual Helpdesk System</h1>
					<form action="/user/searched" method="post">
						<li colspan=1><input placeholder="Search for a problem type..." name="searchbar" type="text"
								class="textinput" id="searchbar" value="" size="30" list="taglist" />
								<datalist id="taglist">
									<option value="Computers">Computers</option>
									<option value="Printers">Printers</option>
									<option value="Network">Network</option>
									<option value="Laptop">Laptop</option>
									<option value="Charger">Charger</option>
									<option value="Monitor">Monitor</option>
									<option value="Ports">Ports</option>
									<option value="Windows">Windows</option>
									<option value="Linux">Linux</option>
									<option value="Paper Jam">Paper Jam</option>
									<option value="Monitor Screen">Monitor Screen</option>
									<option value="Startup Issues">Startup Issues</option>
								</datalist>
							<input type="submit" value="Search" id="searchbutton" class="searchbutton">
					</form>
					</ul>
					<ul>
						<!-- END OF SIDEBAR CODE, START OF USER HISTORY CODE------------------------------------------------ -->
						<div class="historydiv" id="historydiv"> <!--Container user history div, with scrollbar and overflow settings-->
						<h1>User History</h1>
						<script>
							var tickets = <%- JSON.stringify(locals.tickets) %> <!--Bringing in the tickets to display as an object -->
							for (let i = 0; i < tickets.length; i++) {
								document.addEventListener('DOMContentLoaded', function() {
									var div = document.createElement('div'); <!-- Creating a card to append to the container history div -->
									div.id = 'card';
									<!--Card will use a table format internally to avoid confusion caused by too many divs-->
									innerHTMLString = '\
									<table>\
									    <col width="75%" />\
										<col width="25%" />\
										<row height="50%"/>\
										<row height="50%"/>\
										<tr>\
											<td><b style="font-size:20px">'+tickets[i].ticketDescription+'</b></td>\
												<td>Solved '+tickets[i].resolvedTimestamp.substring(0,10)+' \
                                                by <a href = "mailto: '+tickets[i].specEmail+'?subject=Ticket%20ID:%20'+tickets[i].ticketDescription+'\
                                                &body='+tickets[i].ticketDescription+'">'+tickets[i].assignedSpecialistName+'</a></td>\
										</tr>\
										<tr>\
											<td>Ticket Creation Date:'+tickets[i].Date.substring(0,10)+'</td>\
											<td>'+tickets[i].resolvedDescription+'</td>\
										</tr>\
										<tr>\
											<td>\
										'
									<!--There can only be 3 tags per ticket, so this does not need to be done dynamically-->
									<!--These tags are displayed horizontally in one cell of the table-->
									if (tickets[i].mainTag) { innerHTMLString += '<div class="tag-shape" title="'+tickets[i].mainTag+'" >'+tickets[i].mainTag+'</div>'}
									if (tickets[i].secondaryTag) { innerHTMLString += '<div class="tag-shape" style="background-color:#0FAA0F" title="'+tickets[i].secondaryTag+'" >'+tickets[i].secondaryTag+'</div>'}
									if (tickets[i].tertiaryTag) { innerHTMLString += '<div class="tag-shape" style="background-color:#2222CC" title="'+tickets[i].tertiaryTag+'" >'+tickets[i].tertiaryTag+'</div>'}
									
									<!--When view solution button is clicked, the aforementioned searchbar function is forced with the exact search description matching the ticket.-->
									innerHTMLString += '\
											</td>\
											<td><button onclick="fillSearchBar(\''+tickets[i].ticketDescription+'\')" type="submit" id="cardbutton" class="cardbutton">View Solution</button></td>\
										</tr>\
									</table>\
									';
									div.innerHTML = innerHTMLString;
									div.className = 'historycard';
								 
									document.getElementById("historydiv").appendChild(div); <!--Card appended to history div-->
								}, false);
							}
						</script>
						</div>
					</ul>
				</div>
			</div>
		</div>
	</body>
	<script>
	function fillSearchBar(query) {
		var srch = document.getElementById("searchbar");
		var srchbtn = document.getElementById("searchbutton");
		srch.setAttribute("value", query);
		srchbtn.click()
	}
	</script>
</html>